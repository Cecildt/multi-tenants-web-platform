---
import TenantDeleteDialog from "../dialogs/TenantDeleteDialog.astro";
import TenantDetailsDialog from "../dialogs/TenantDetailsDialog.astro";
---

<div class="overflow-x-auto">
  <table class="table">
    <!-- head -->
    <thead>
      <tr>
        <th>ID</th>
        <th>Business Name</th>
        <th>Tenant Name</th>
        <th>Email</th>
        <th>Created Date</th>
        <th>Updated Date</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <!-- row 1 -->
      <tr>
        <th>eMtI22o3LYUNXzVQoz6us</th>
        <td>Company A</td>
        <td>comany-a-2344</td>
        <td>comp-a@test.com</td>
        <td>2025-02-01 15:00</td>
        <td>2025-02-01 15:00</td>
        <td
          ><a
            class="btn btn-warning btn-xs"
            href="/tenants/eMtI22o3LYUNXzVQoz6us">Edit</a
          ></td
        >
        <td
          ><button
            class="btn btn-info btn-xs mt-btn-tenant-details"
            onclick="tenantDetailsDialog.showModal()"
            data-tenant-id="eMtI22o3LYUNXzVQoz6us">Details</button
          ></td
        >
        <td
          ><button
            class="btn btn-error btn-xs mt-btn-tenant-delete"
            onclick="tenantDeleteDialog.showModal()"
            data-tenant-id="eMtI22o3LYUNXzVQoz6us">Delete</button
          ></td
        >
      </tr>
      <!-- row 2 -->
      <tr>
        <th>eMtI22o3LYUNXzVQoz6us</th>
        <td>Company B</td>
        <td>comany-a-2344</td>
        <td>comp-b@test.com</td>
        <td>2025-02-01 15:00</td>
        <td>2025-02-01 15:00</td>
        <td
          ><a
            class="btn btn-warning btn-xs"
            href="/tenants/eMtI22o3LYUNXzVQoz6us">Edit</a
          ></td
        >
        <td
          ><button
            class="btn btn-info btn-xs mt-btn-tenant-details"
            onclick="tenantDetailsDialog.showModal()"
            data-tenant-id="eMtI22o3LYUNXzVQoz777">Details</button
          ></td
        >
        <td
          ><button
            class="btn btn-error btn-xs mt-btn-tenant-delete"
            onclick="tenantDeleteDialog.showModal()"
            data-tenant-id="eMtI22o3LYUNXzVQoz777">Delete</button
          ></td
        >
      </tr>
      <!-- row 3 -->
      <tr>
        <th>eMtI22o3LYUNXzVQoz333</th>
        <td>Company C</td>
        <td>comany-a-2344</td>
        <td>comp-c@test.com</td>
        <td>2025-02-01 15:00</td>
        <td>2025-02-01 15:00</td>
        <td><button class="btn btn-warning btn-xs">Edit</button></td>
        <td><button class="btn btn-info btn-xs">Details</button></td>
        <td><button class="btn btn-error btn-xs">Delete</button></td>
      </tr>
    </tbody>
  </table>
</div>
<!-- dialogs -->
<TenantDetailsDialog />
<TenantDeleteDialog />

<script>
  import { actions } from "astro:actions";

  document.querySelectorAll(".mt-btn-tenant-details").forEach((btn) => {
    btn.addEventListener("click", async (e) => {
      let btn = e.target as HTMLButtonElement;
      const tenantId = btn.getAttribute("data-tenant-id");
      const tenantInput = document.getElementById(
        "details_tenantId"
      ) as HTMLInputElement;
      if (tenantInput) {
        tenantInput.value = tenantId ?? "unknown";
      }
      const { data, error } = await actions.tenants.getTenant({
        tenant_id: tenantId ?? "unknown",
      });

      // Set dialog values
      document.getElementById("tenant_details_id")!.textContent = data?.tenant_id ?? "unknown";
      document.getElementById("tenant_details_business")!.textContent = data?.business_name ?? "unknown";
      document.getElementById("tenant_details_name")!.textContent = data?.tenant_name ?? "unknown";
      document.getElementById("tenant_details_email")!.textContent = data?.email ?? "unknown";
      document.getElementById("tenant_details_created")!.textContent = data?.created_at.toISOString() ?? new Date().toISOString();
      // document.getElementById("tenant_details_updated")!.textContent = data?.updated_at ?? new Date().toISOString();
    });
  });

  document.querySelectorAll(".mt-btn-tenant-delete").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      let btn = e.target as HTMLButtonElement;
      const tenantId = btn.getAttribute("data-tenant-id");
      console.log("Delete Tenant ID:", tenantId);
      const tenantInput = document.getElementById(
        "delete_tenantId"
      ) as HTMLInputElement;
      if (tenantInput) {
        tenantInput.value = tenantId ?? "unknown";
      }
    });
  });
</script>
